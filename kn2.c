#include <stdio.h>

static const int degree [64] = {
	2,3,4,4,4,4,3,2,
	3,4,6,6,6,6,4,3,
	4,6,8,8,8,8,6,4,
	4,6,8,8,8,8,6,4,
	4,6,8,8,8,8,6,4,
	4,6,8,8,8,8,6,4,
	3,4,6,6,6,6,4,3,
	2,3,4,4,4,4,3,2
};

static const int kng[64][8] = {
	{17,10,0,0,0,0,0,0},
	{18,11,16,0,0,0,0,0},
	{19,12,8,17,0,0,0,0},
	{20,13,9,18,0,0,0,0},
	{21,14,10,19,0,0,0,0},
	{22,15,11,20,0,0,0,0},
	{23,12,21,0,0,0,0,0},
	{13,22,0,0,0,0,0,0},
	{25,18,2,0,0,0,0,0},
	{26,19,3,24,0,0,0,0},
	{27,20,4,0,16,25,0,0},
	{28,21,5,1,17,26,0,0},
	{29,22,6,2,18,27,0,0},
	{30,23,7,3,19,28,0,0},
	{31,4,20,29,0,0,0,0},
	{5,21,30,0,0,0,0,0},
	{33,26,10,1,0,0,0,0},
	{34,27,11,2,0,32,0,0},
	{35,28,12,3,1,8,24,33},
	{36,29,13,4,2,9,25,34},
	{37,30,14,5,3,10,26,35},
	{38,31,15,6,4,11,27,36},
	{39,7,5,12,28,37,0,0},
	{6,13,29,38,0,0,0,0},
	{41,34,18,9,0,0,0,0},
	{42,35,19,10,8,40,0,0},
	{43,36,20,11,9,16,32,41},
	{44,37,21,12,10,17,33,42},
	{45,38,22,13,11,18,34,43},
	{46,39,23,14,12,19,35,44},
	{47,15,13,20,36,45,0,0},
	{14,21,37,46,0,0,0,0},
	{49,42,26,17,0,0,0,0},
	{50,43,27,18,16,48,0,0},
	{51,44,28,19,17,24,40,49},
	{52,45,29,20,18,25,41,50},
	{53,46,30,21,19,26,42,51},
	{54,47,31,22,20,27,43,52},
	{55,23,21,28,44,53,0,0},
	{22,29,45,54,0,0,0,0},
	{57,50,34,25,0,0,0,0},
	{58,51,35,26,24,56,0,0},
	{59,52,36,27,25,32,48,57},
	{60,53,37,28,26,33,49,58},
	{61,54,38,29,27,34,50,59},
	{62,55,39,30,28,35,51,60},
	{63,31,29,36,52,61,0,0},
	{30,37,53,62,0,0,0,0},
	{58,42,33,0,0,0,0,0},
	{59,43,34,32,0,0,0,0},
	{60,44,35,33,40,56,0,0},
	{61,45,36,34,41,57,0,0},
	{62,46,37,35,42,58,0,0},
	{63,47,38,36,43,59,0,0},
	{39,37,44,60,0,0,0,0},
	{38,45,61,0,0,0,0,0},
	{50,41,0,0,0,0,0,0},
	{51,42,40,0,0,0,0,0},
	{52,43,41,48,0,0,0,0},
	{53,44,42,49,0,0,0,0},
	{54,45,43,50,0,0,0,0},
	{55,46,44,51,0,0,0,0},
	{47,45,52,0,0,0,0,0},
	{46,53,0,0,0,0,0,0}
};

int visited [64] = {
	 0,32,32,32,32,32,32,32,
	32,32,32,32,32,32,32,32,
	32,32,32,32,32,32,32,32,
	32,32,32,32,32,32,32,32,
	32,32,32,32,32,32,32,32,
	32,32,32,32,32,32,32,32,
	32,32,32,32,32,32,32,32,
	32,32,32,32,32,32,32,32
};

static FILE *fp;

static const char translate[64] = {
	'@','0','1','2','3','4','5','6','7','8','9','a','b','c','d','e',
	'f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u',
	'v','w','x','y','z','+','A','B','C','D','E','F','G','H','I','J',
	'K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z',
};

void file_translate() {
	static long count = 0;
	for (int i = 0; i < 8; i++) {
		for (int j = 0; j < 8; j++) {
			// fprintf(fp, "%d ", (int)visited[i*8+j]);
			int idx = (int)(visited[i*8+j]);
			fputc(translate[idx], fp);
		}
		// fprintf(fp, "\n");
	}
	// fprintf(fp, "\n");
	fputc('\n', fp);
	printf("%ld", count);
	count++;
}

void print_board() {
	for (int i = 0; i < 8; i++) {
		for (int j = 0; j < 8; j++) {
			printf("%*d ", 2, (int)visited[i*8+j]);
		}
		printf("\n");
	}
	printf("\n");
}

void traverse(int fnode, int bnode, int pos) {
	
	print_board();

	if (pos == 32) {
		file_translate();
		return;
	}

	if (fnode == bnode) {
		return;
	}

	visited[fnode] = pos;
    visited[bnode] = 64 - pos;

    int df = degree[fnode];
    int db = degree[bnode];

    for (int i = 0; i < df; i++) {
    	for (int j = 0; j < db; j++) {
    		int fn = kng[fnode][i];
    		int bn = kng[bnode][j];
    		if (visited[fn] == 32 && visited[bn] == 32) {
                traverse(fn, bn, pos+1);
    		}
    	}
    }      

    visited[fnode] = 32;
    visited[bnode] = 32;
    return;
}

int main() {
	printf("Closed Knights Tours found:\n");
	fp = fopen("tours2_c.txt", "w");
	traverse(10,17,1); 
	// Node 10 is the front, node 17 is the back, they are the 1st nodes to be visited
}